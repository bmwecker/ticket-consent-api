# üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏–π

## –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ

–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏–π –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
ticket-service/
‚îÇ
‚îú‚îÄ‚îÄ üêç BACKEND (Python/Flask)
‚îÇ   ‚îú‚îÄ‚îÄ api.py                           # Flask API —Å endpoints
‚îÇ   ‚îú‚îÄ‚îÄ database_tickets.py              # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ save_document_snapshot.py        # –°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è snapshots
‚îÇ
‚îú‚îÄ‚îÄ üåê FRONTEND (JavaScript)
‚îÇ   ‚îî‚îÄ‚îÄ tilda-consent-logger.js          # –ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Tilda
‚îÇ
‚îú‚îÄ‚îÄ üöÄ DEPLOYMENT
‚îÇ   ‚îú‚îÄ‚îÄ Procfile                         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Render
‚îÇ   ‚îú‚îÄ‚îÄ runtime.txt                      # –í–µ—Ä—Å–∏—è Python (3.11.7)
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt                 # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îÇ   ‚îî‚îÄ‚îÄ .gitignore                       # –ß—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ Git
‚îÇ
‚îî‚îÄ‚îÄ üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø
    ‚îú‚îÄ‚îÄ README.md                        # –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
    ‚îú‚îÄ‚îÄ QUICKSTART.md                    # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (15 –º–∏–Ω—É—Ç)
    ‚îú‚îÄ‚îÄ DEPLOY_GUIDE.md                  # –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
    ‚îî‚îÄ‚îÄ OVERVIEW.md                      # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏–π

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–û–ì–õ–ê–°–ï–ù" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Tilda:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–°–û–ì–õ–ê–°–ï–ù"
         ‚Üì
JavaScript –≤—ã—á–∏—Å–ª—è–µ—Ç SHA-256 —Ö–µ—à —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
         ‚Üì
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à API
         ‚Üì
API —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL:
  - –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞
  - –í–µ—Ä—Å–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞
  - –•–µ—à —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
  - –í—Ä–µ–º—è —Å–æ–≥–ª–∞—Å–∏—è (UTC)
  - IP –∞–¥—Ä–µ—Å
  - –ë—Ä–∞—É–∑–µ—Ä/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–µ—Å—Å–∏–∏
         ‚Üì
–ü–æ–ø–∞–ø –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è (–≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
```

**–í–∞–∂–Ω–æ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –∏ –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

### 2. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–ß–µ—Ä–µ–∑ API (–∏–ª–∏ —Å–∫—Ä–∏–ø—Ç) –≤—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ –ø–æ–ª–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```
–ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /api/document-snapshot
         ‚Üì
API –≤—ã—á–∏—Å–ª—è–µ—Ç SHA-256 —Ö–µ—à —Ç–µ–∫—Å—Ç–∞
         ‚Üì
–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏
         ‚Üì
–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—É—é
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ –±—É–¥—É—â–µ–º –¥–æ–∫–∞–∑–∞—Ç—å, **–∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ —Ç–µ–∫—Å—Ç** –≤–∏–¥–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏–π

–í—ã (–∏–ª–∏ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞) –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ —Ç—Ä–∏ —Å–æ–≥–ª–∞—Å–∏—è:

```
GET /api/consent/verify/{session_id}
         ‚Üì
API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ç—Ä—ë—Ö —Å–æ–≥–ª–∞—Å–∏–π
         ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å: –≤—Å–µ –¥–∞–Ω—ã –∏–ª–∏ –Ω–µ—Ç
```

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `consent_logs` (–ª–æ–≥–∏ —Å–æ–≥–ª–∞—Å–∏–π)

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = –æ–¥–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–¥–Ω–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:**
```
consent_log_id:      550e8400-e29b-41d4-a716-446655440000
session_id:          123e4567-e89b-12d3-a456-426614174000
document_type:       privacy_policy
document_version:    v2025-10-28
document_hash:       a3f2b1c...  (SHA-256)
consent_given:       true
consent_timestamp:   2025-10-28T14:30:00Z
client_ip:           185.45.23.67
user_agent:          Mozilla/5.0 (Windows NT 10.0; Win64; x64)...
ip_country:          IL
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- –ü–æ `session_id` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö —Å–æ–≥–ª–∞—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ `document_type` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
- –ü–æ `consent_timestamp` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

### –¢–∞–±–ª–∏—Ü–∞ `document_snapshots` (–∞—Ä—Ö–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ = –æ–¥–Ω–∞ –≤–µ—Ä—Å–∏—è –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:**
```
snapshot_id:         660f9511-f39c-52e5-b827-557766551111
document_type:       ticket_terms
version:             v2025-10-28
content_hash:        b4e3c2d...  (SHA-256)
full_text:           "–£–°–õ–û–í–ò–Ø –ü–†–û–î–ê–ñ–ò –ë–ò–õ–ï–¢–û–í\n\n1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è..."
language:            ru
is_active:           true
created_at:          2025-10-28T10:00:00Z
```

**–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:** –ù–∞ –∫–∞–∂–¥–æ–º —è–∑—ã–∫–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞.

---

## üîå API Endpoints

### 1. `GET /health`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, —Ç–µ—Å—Ç—ã  
**–û—Ç–≤–µ—Ç:** `{"status": "healthy"}`

### 2. `POST /api/consent`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ JavaScript –Ω–∞ Tilda  
**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–ø—É–±–ª–∏—á–Ω—ã–π endpoint)

### 3. `GET /api/consent/verify/{session_id}`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–æ–≥–ª–∞—Å–∏–π  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É  
**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### 4. `POST /api/document-snapshot`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ snapshot –¥–æ–∫—É–º–µ–Ω—Ç–∞  
**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ê–¥–º–∏–Ω (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –∏–ª–∏ curl)  
**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è `X-API-Key` –∑–∞–≥–æ–ª–æ–≤–æ–∫

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:

‚úÖ **CORS** - —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã  
‚úÖ **HTTPS** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —à–∏—Ñ—Ä—É—é—Ç—Å—è –≤ –ø–µ—Ä–µ–¥–∞—á–µ  
‚úÖ **API –∫–ª—é—á** - –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã  
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è  
‚úÖ **SQL Injection** - –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (psycopg)  
‚úÖ **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ SHA-256

### –ß—Ç–æ –ù–ï –∑–∞—â–∏—â–µ–Ω–æ (–ø–æ–∫–∞):

‚ö†Ô∏è **Rate Limiting** - –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Flask-Limiter)  
‚ö†Ô∏è **IP Whitelisting** - –Ω–µ—Ç –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞ IP (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ API)  
‚ö†Ô∏è **DDoS –∑–∞—â–∏—Ç–∞** - –±–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ Render (–¥–ª—è —Å–µ—Ä—å—ë–∑–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω—É–∂–µ–Ω Cloudflare)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω:

1. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ CORS:**
   ```
   ALLOWED_ORIGINS=https://yoursite.tilda.ws
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–π API –∫–ª—é—á:**
   ```bash
   # –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ 64-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–ª—é—á
   openssl rand -hex 32
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏

4. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã:**
   - Render –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã PostgreSQL
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "Backups"

---

## üìä –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–í—Å–µ–≥–æ —Å–æ–≥–ª–∞—Å–∏–π:**
```sql
SELECT COUNT(*) FROM consent_logs;
```

**–ü–æ —Ç–∏–ø–∞–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
```sql
SELECT document_type, COUNT(*) 
FROM consent_logs 
GROUP BY document_type;
```

**–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```sql
SELECT COUNT(DISTINCT session_id) FROM consent_logs;
```

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–≥–ª–∞—Å–∏–π:**
```sql
SELECT 
  session_id, 
  document_type, 
  consent_timestamp,
  client_ip,
  ip_country
FROM consent_logs 
ORDER BY consent_timestamp DESC 
LIMIT 10;
```

**–°–æ–≥–ª–∞—Å–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è:**
```sql
SELECT COUNT(*) 
FROM consent_logs 
WHERE DATE(consent_timestamp) = CURRENT_DATE;
```

**–ü–æ–ª–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (–≤—Å–µ 3 —Å–æ–≥–ª–∞—Å–∏—è):**
```sql
SELECT session_id, COUNT(*) as consents_count
FROM consent_logs
GROUP BY session_id
HAVING COUNT(*) = 3;
```

### –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV (–¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏)

```sql
COPY (
  SELECT 
    consent_log_id,
    session_id,
    document_type,
    document_version,
    consent_timestamp,
    client_ip
  FROM consent_logs
  WHERE consent_timestamp >= '2025-10-01'
) TO '/tmp/consents_october.csv' WITH CSV HEADER;
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ API –ª–æ–∫–∞–ª—å–Ω–æ:
   ```bash
   python api.py
   ```

2. –í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Tilda

3. –í JavaScript –∫–æ–¥–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ URL:
   ```javascript
   const API_URL = 'http://localhost:5000/api/consent';
   ```

4. –ù–∞–∂–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ

### Production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Tilda
2. –ù–∞–∂–º–∏—Ç–µ F12 ‚Üí Console
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–û–ì–õ–ê–°–ï–ù"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
   ```
   üì§ Sending consent log: privacy_policy
   ‚úÖ Consent logged successfully: uuid
   ```

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ API:
   ```bash
   curl https://your-api.onrender.com/api/consent/verify/SESSION_ID
   ```

---

## üîß Maintenance (–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

1. **–û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é** –≤ `.env`:
   ```
   DOCUMENT_VERSION=v2025-11-15
   ```

2. **–û–±–Ω–æ–≤–∏—Ç–µ JavaScript** –Ω–∞ Tilda (–≤ `DOCUMENT_VERSIONS`)

3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–æ–≤—ã–π snapshot:**
   ```bash
   python save_document_snapshot.py
   ```

4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å** –Ω–∞ Render (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é:**
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ Render (–∏—â–∏—Ç–µ –æ—à–∏–±–∫–∏)
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≥–ª–∞—Å–∏–π –≤ –ë–î
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ snapshots —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

**–ö–∞–∂–¥—ã–π –º–µ—Å—è—Ü:**
- –î–µ–ª–∞–π—Ç–µ backup –ë–î (–≤—Ä—É—á–Ω—É—é –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ (PostgreSQL Free = 1GB)

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**Python –ø–∞–∫–µ—Ç—ã:**
```bash
pip list --outdated
pip install --upgrade flask flask-cors psycopg
pip freeze > requirements.txt
git commit -am "Update dependencies"
git push
```

Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç —Å–µ—Ä–≤–∏—Å.

---

## üí° –°–æ–≤–µ—Ç—ã –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ DO (–¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫):

- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ snapshot –°–†–ê–ó–£ –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤–µ–∑–¥–µ
- ‚úÖ –î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã –ë–î
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π

### ‚ùå DON'T (–Ω–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫):

- ‚ùå –ù–ï —É–¥–∞–ª—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ snapshots –∏–∑ –ë–î (–Ω—É–∂–Ω—ã –¥–ª—è –∞—É–¥–∏—Ç–∞)
- ‚ùå –ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ API –∫–ª—é—á–∏ –≤ Git (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ .env)
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ALLOWED_ORIGINS=*` –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
- ‚ùå –ù–ï –∏–∑–º–µ–Ω—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤ `consent_logs` (—Ç–æ–ª—å–∫–æ INSERT)
- ‚ùå –ù–ï –æ—Ç–∫–ª—é—á–∞–π—Ç–µ HTTPS

---

## üìû –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏...

### ...API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –Ω–∞ Render Dashboard
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ (–≤–∫–ª–∞–¥–∫–∞ "Logs")
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å (Manual Deploy)

### ...JavaScript –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ?

1. –û—Ç–∫—Ä–æ–π—Ç–µ F12 ‚Üí Console
2. –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ (–∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL API –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### ...–ë–î –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞?

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä: `SELECT pg_size_pretty(pg_database_size('database_name'));`
2. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
3. –û–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–Ω PostgreSQL –Ω–∞ Render (–ø–ª–∞—Ç–Ω–æ)

### ...–ù—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ?

```sql
-- –û–°–¢–û–†–û–ñ–ù–û! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ!
DELETE FROM consent_logs WHERE session_id LIKE 'test%';
```

---

## üéì –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏–π, —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–§–æ—Ä–º–∞ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫—É–ø–∞—Ç–µ–ª—è**
   - –ò–º—è, email, —Ç–µ–ª–µ—Ñ–æ–Ω
   - –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –±–∏–ª–µ—Ç–∞

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã**
   - Stripe / PayPal / Fondy
   - Webhook'–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤**
   - PDF —Å QR-–∫–æ–¥–æ–º
   - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

4. **–û—Ç–ø—Ä–∞–≤–∫–∞ –±–∏–ª–µ—Ç–æ–≤**
   - Email (SendGrid / Mailgun)
   - WhatsApp (Twilio)

5. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–∫—É–ø–æ–∫
   - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

**–í–æ–ø—Ä–æ—Å—ã? –ü—Ä–æ–±–ª–µ–º—ã? –°–º–æ—Ç—Ä–∏—Ç–µ [DEPLOY_GUIDE.md](DEPLOY_GUIDE.md) –∏–ª–∏ [README.md](README.md)**

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–¥–∞–∂–∏ –±–∏–ª–µ—Ç–æ–≤ üé´**

